<!DOCTYPE html>
<html class="no-js" lang="es">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="" />

  <!-- Site Title -->
    <title>Carlos Maroto Daweb - Blog Portfolio</title>

  <!-- Place favicon.ico in the root directory -->
  <link rel="apple-touch-icon" href="./assets/img/favicon.png" />
  <link rel="shortcut icon" type="image/png" href="./assets/img/favicon.png" />

  <!-- CSS here -->
  <link rel="stylesheet" href="assets/css/animate.min.css">
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/font-awesome-pro.min.css">
  <link rel="stylesheet" href="assets/css/flaticon_gerold.css">
  <link rel="stylesheet" href="assets/css/nice-select.css">
  <link rel="stylesheet" href="assets/css/backToTop.css">
  <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
  <link rel="stylesheet" href="assets/css/odometer-theme-default.css">
  <link rel="stylesheet" href="assets/css/magnific-popup.css">

  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="assets/css/responsive.css">
</head>

<body class="absolute_header">

  <!-- Preloader Area Start -->
  <div class="preloader">
    <svg viewBox="0 0 1000 1000" preserveAspectRatio="none">
      <path id="preloaderSvg" d="M0,1005S175,995,500,995s500,5,500,5V0H0Z"></path>
    </svg>

    <div class="preloader-heading">
      <div class="load-text">
        <span>C</span>
        <span>a</span>
        <span>r</span>
        <span>g</span>
        <span>a</span>
        <span>n</span>
        <span>d</span>
        <span>o</span>
      </div>
    </div>
  </div>
  <!-- Preloader Area End -->


  <!-- start: Back To Top -->
  <div class="progress-wrap" id="scrollUp">
    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
      <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
    </svg>
  </div>
  <!-- end: Back To Top -->


  <!-- HEADER START -->
  <header class="tj-header-area header-absolute">
    <div class="container">
      <div class="row">
        <div class="col-12 d-flex flex-wrap align-items-center">

          <div class="logo-box">
            <a href="index.html">
              <img src="assets/img/logo/logo.png" alt="Carlos Maroto Daweb">
            </a>
          </div>

          <div class="header-info-list d-none d-md-inline-block">
            <ul class="ul-reset">
              <li><a href="mailto:carlosmaroto.daweb@gmail.com">carlosmaroto.daweb@gmail.com</a></li>
            </ul>
          </div>

          <div class="header-menu">
            <nav>
              <ul>
                <li><a href="index.html#resume-section">Resumen</a></li>
                <li><a href="index.html#skills-section">Tecnologías</a></li>
                <li><a href="index.html#works-section">Trabajos</a></li>
                <li><a href="index.html#blog-section">Blog</a></li>
              </ul>
            </nav>
          </div>
          <!--
          <div class="header-button">
              <a href="#contact-section" class="btn tj-btn-primary">Contacto</a>
          </div>
          -->

          <div class="menu-bar d-lg-none">
            <button>
              <span></span>
              <span></span>
              <span></span>
              <span></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>
  <header class="tj-header-area header-2 header-sticky sticky-out">
    <div class="container">
      <div class="row">
        <div class="col-12 d-flex flex-wrap align-items-center">

          <div class="logo-box">
            <a href="index.html">
              <img src="assets/img/logo/logo.png" alt="Carlos Maroto Daweb">
            </a>
          </div>

          <div class="header-info-list d-none d-md-inline-block">
            <ul class="ul-reset">
              <li><a href="mailto:carlosmaroto.daweb@gmail.com">carlosmaroto.daweb@gmail.com</a></li>
            </ul>
          </div>

          <div class="header-menu">
            <nav>
              <ul>
                <li><a href="index.html#resume-section">Resumen</a></li>
                <li><a href="index.html#skills-section">Tecnologías</a></li>
                <li><a href="index.html#works-section">Trabajos</a></li>
                <li><a href="index.html#blog-section">Blog</a></li>
              </ul>
            </nav>
          </div>
          <!--
          <div class="header-button">
              <a href="#contact-section" class="btn tj-btn-primary">Contacto</a>
          </div>
          -->

          <div class="menu-bar d-lg-none">
            <button>
              <span></span>
              <span></span>
              <span></span>
              <span></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!-- HEADER END -->

  <main class="site-content" id="content">

    <!-- START: Breadcrumb Area -->
    <section class="breadcrumb_area" data-bg-image="./assets/img/breadcrumb/breadcrumb-bg2.png" data-bg-color="#140C1C">
      <div class="container">
        <div class="row">
          <div class="col">
            <div class="breadcrumb_content d-flex flex-column align-items-center">
              <h2 class="title wow fadeInUp" data-wow-delay=".3s">Crea tu Propio Servidor Web</h2>
              <div class="breadcrumb_navigation wow fadeInUp" data-wow-delay=".5s">
                <span><a href="index.html#blog-section">Blog</a></span>
                <i class="far fa-long-arrow-right"></i>
                <span class="current-item">Blog Server</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- END: Breadcrumb Area -->

    <!-- START: Blog Section -->
    <section class="full-width tj-post-details__area">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="tj-post-details__container">
              <article class="tj-single__post">
                <div class="tj-post__thumb">
                  <img src="./assets/img/blog/blog-5.png" alt="">

                  <a class="category">Tutorial</a>
                </div>

                <div class="tj-post__content">
                  <div class="tj-post__meta entry-meta">
                    <span><i class="fa-light fa-user"></i> <a>por Carlos Maroto</a></span>
                    <span><i class="fa-light fa-calendar-days"></i> 07 Jul, 2024</span>
                    <span><i class="fa-light fa-comments"></i><a>Comentarios (0)</a></span>
                  </div>
                  </br>
                  <h3 class="tj-post__title entry-title">
                    Expandiendo tu Proyecto de Portfolio: Configuración de un Servidor Local con un Portátil Antiguo
                  </h3>

                  <div class="tj-post__content">
                    <p>
                      En este nuevo post, te guiaré a través de los pasos para convertir un portátil antiguo en un servidor local para tu portafolio de proyectos. Este proceso reemplaza la instancia EC2 de AWS que utilizabas previamente, permitiéndote tener control total sobre tu servidor desde casa. A continuación, detallo los pasos que he seguido para llevar a cabo esta configuración.
                    </p>

                    <h6>Tecnologías Utilizadas</h6>
                    <ul>
                      <li>Ubuntu Server</li>
                      <li>DuckDNS</li>
                      <li>GitHub</li>
                      <li>Docker</li>
                      <li>NGINX</li>
                    </ul>

                    <h4>Planteamiento Inicial</h4>
                    <p>
                      Quiero aclarar que esta publicación está basada en mi experiencia personal al desarrollar esta web. Lo que
                      compartiré es lo que me ha funcionado y he querido implementar. Soy consciente de que hay aspectos que se pueden
                      mejorar, ampliar y que algunos son opcionales; los abordaremos poco a poco.
                    </p>
                    <p>
                      Para crear un portafolio básico donde podamos subir nuestros proyectos, debemos tener claras las diferentes
                      etapas en el desarrollo de este proyecto:
                    </p>
                    <ol>
                      <li> Creación y configuración de nuestro servidor</li>
                      <li> Comprar y configurar dominio</li>
                      <li> Dockerización de nuestros proyectos web</li>
                      <li> Automatización del despliegue de estos proyectos</li>
                      <li> Gestión de los recursos de nuestro servidor</li>
                    </ol>

                    <h4>1. Creación y configuración de nuestro servidor</h4>
                    <p>
                      Hoy en día, existen muchas opciones para tener un servidor web. En mi caso, he optado por el Cloud de Amazon AWS, 
                      específicamente utilizando Amazon Elastic Compute Cloud (instancias EC2). Estas instancias son básicamente máquinas 
                      virtuales en la nube. Elegí esta opción porque está incluida en el nivel gratuito de AWS durante el primer año, 
                      ofreciendo 750 horas al mes sin costo, lo que permite ejecutar una sola instancia las 24 horas del día sin problemas.
                    </p>
                    <p>
                      Para acceder a este servicio, primero debes crear una cuenta en <a href="https://aws.amazon.com" target="_blank">AWS Amazon</a>. 
                      Es importante tener en cuenta que deberás proporcionar una tarjeta bancaria. Te recomiendo usar una tarjeta virtual 
                      o una cuenta con poco dinero disponible. Esto es porque, aunque se pueden configurar alertas sobre el coste de los 
                      servicios utilizados, no hay una manera completamente segura de evitar que te cobren por ciertos servicios. No obstante, 
                      todo lo que utilizaremos es gratuito durante el primer año. Este consejo es útil si deseas explorar otros servicios de 
                      AWS que pueden tener costos asociados.
                    </p>
                    <p>
                      Una vez que hayas creado tu cuenta en AWS, sigue estos pasos desde el panel de control para lanzar una instancia EC2:
                      <ol>
                        <li>
                          <p>Accede a EC2</p>
                          <ul>
                            <li>Navega a Servicios >> EC2.</li>
                            <li>Haz clic en "Lanzar Instancia".</li>
                          </ul>
                        </li>
                        <li>
                          <p>Completa los siguientes campos</p>
                          <ul>
                            <li>Nombre y Etiquetas: Asigna un nombre a la instancia según tu preferencia.</li>
                            <li>Imágenes de Aplicaciones y Sistemas Operativos: Selecciona la imagen Ubuntu Server 24.04.</li>
                            <li>Tipo de Instancia: Elige t2.micro (1 vCPU, 1 GiB de memoria), que es apto para la capa gratuita.</li>
                            <li>Par de Claves: Genera un nuevo par de claves si no tienes uno existente.</li>
                            <li>Configuraciones de Red: Asegúrate de permitir tráfico para HTTP y HTTPS.</li>
                            <li>Configurar Almacenamiento: Puedes usar hasta 30 GiB de disco gp3.</li>
                          </ul>
                        </li>
                        <li>
                          <p>Advertencia Importante</p>
                          <ul>
                            <li>Asegúrate siempre de usar la configuración que especifica "Apto para la capa gratuita" para evitar costos adicionales.</li>
                          </ul>
                        </li>
                        <li>
                          <p>Iniciar Instancia</p>
                          <ul>
                            <li>Selecciona la instancia recién creada y haz clic en Estado de la Instancia >> Iniciar Instancia.</li>
                            <li>Ya solo queda esperar a que es estado cambie a "En ejecución"</li>
                          </ul>
                        </li>
                        <li>
                          <p>Conectarnos al servidor por SSH</p>
                          <ol>
                            <li>
                              <p>Accede a la Instancia</p>
                              <ul>
                                <li>En el panel de control de EC2, selecciona la instancia que quieres conectar.</li>
                              </ul>
                            </li>
                            <li>
                              <p>Abrir Conexión SSH</p>
                              <ul>
                                <li>Haz clic en el botón Conectar.</li>
                                <li>Ve a la pestaña Cliente SSH.</li>
                              </ul>
                            </li>
                            <li>
                              <p>Sigue las Instrucciones</p>
                              <ul>
                                <li>
                                  <p>
                                    Sigue los pasos indicados en la pestaña Cliente SSH para conectarte de forma remota. 
                                    Normalmente, esto implicará abrir una terminal en tu computadora y ejecutar un comando similar al siguiente:
                                  </p>
                                  <blockquote class="wp-block-quote">
                                    <pre><code>ssh -i "ruta/a/tu/par_de_claves.pem" ubuntu@dirección_IP_de_tu_instancia</code></pre>
                                  </blockquote>
                                </li>
                                <li>Asegúrate de reemplazar "ruta/a/tu/par_de_claves.pem" con la ruta al archivo de tu par de claves y 
                                  dirección_IP_de_tu_instancia con la dirección IP pública de tu instancia.</li>
                              </ul>
                            </li>
                          </ol>
                        </li>
                        <li>
                          <p>Configuración de Ubuntu</p>
                          <ul>
                            <li>
                              <p>Una vez estamos dentro del servidor podemos hacer una instalación de todo lo necesario con estos comandos:</p>
                              
                              <blockquote class="wp-block-quote">
                                <pre><code>sudo apt update && sudo apt upgrade

sudo apt install certbot
                                
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc
                                
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update
                                
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
                                
sudo apt install nginx
                                </code></pre>
                              </blockquote>
                            </li>
                          </ul>
                        </li>
                        <li>
                          <p>Creación de Script para gestionar Nginx</p>
                          <ul>
                            <li>
                              <p>
                                Para facilitar la automatización del despliegue de los repositorios con la configuración de nuestro Proxy Inverso, crea un script llamado restore_docker.sh en tu máquina local con el siguiente contenido:
                              </p>
                              
                              <blockquote class="wp-block-quote">
                                <pre><code>#!/bin/bash

sudo docker stop $(sudo docker ps -a -q)
sudo docker rm $(sudo docker ps -a -q)
sudo docker rmi $(sudo docker images -q)
sudo docker volume rm $(sudo docker volume ls -q)
if [ -d /etc/nginx/sites-available/ ]; then
  cd /etc/nginx/sites-available/
  for archivo in *; do
    if [ "$archivo" != "default" ]; then
      sudo rm "$archivo"
    fi
  done
fi
if [ -d /etc/nginx/sites-enabled/ ]; then
  cd /etc/nginx/sites-enabled/
  for archivo in *; do
    if [ "$archivo" != "default" ]; then
      sudo rm "$archivo"
    fi
  done
fi
sudo rm -r /etc/letsencrypt/live
sudo systemctl restart docker
                                </code></pre>
                              </blockquote>
                            </li>
                          </ul>
                        </li>
                      </ol>
                    </p>
                    <p>
                      Si deseas saber más sobre AWS y ver paso a paso cómo funciona, puedes ver este video del creador de contenido y desarrollador <a href="https://www.youtube.com/watch?v=zQyrhjEAqLs&t=2884s&ab_channel=midulive" target="_blank">Midudev:</a>
                    </p>
                    <iframe class="responsive-iframe" src="https://www.youtube.com/embed/zQyrhjEAqLs?si=4fcmszid14or_wQ7" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

                    <h4>2. Comprar y configurar dominio</h4>
                    <p>
                      Este paso es opcional, ya que la propia instancia EC2 proporciona un DNS público para mostrar tu web. Sin embargo, es mucho más profesional utilizar tu propio dominio, lo que también te permite crear subdominios para gestionar más fácilmente el acceso a tus proyectos, como veremos más adelante.
                    </p>
                    <p>
                      Yo he comprado un dominio .com en IONOS por solo 1,21€ el primer año, pero puedes utilizar el proveedor de servicios que prefieras. Lo importante es que el dominio apunte a la IP de la máquina EC2. Para evitar que esta cambie cuando se apague, puedes configurar una IP elástica en el panel de EC2, en el apartado "Direcciones IP elásticas".
                    </p>

                    <h4>3. Dockerización de nuestros proyectos web</h4>
                    <p>
                      Soy un ferviente defensor de utilizar Docker en todos mis proyectos, ya que considero que es una herramienta extremadamente conveniente. Docker permite encapsular todo un proyecto en un repositorio, junto con su configuración, lo que facilita la creación de contenedores locales que contienen todos los componentes necesarios para ejecutar el código.
                    </p>
                    <p>
                      Siguiendo esta filosofía de que un repositorio debe incluir todo lo necesario para un proyecto de forma aislada, he creado numerosos repositorios en mi GitHub que utilizan Docker, tales como:
                    </p>
                              
                    <blockquote class="wp-block-quote">
                      <pre><code>version: "3.1"
services:
  mysql_poison:
    container_name: mysql_poison
    build: 
      context: .
      dockerfile: Dockerfile_db
    image: poison-db
    ports: 
      - "9000:3306"
    environment:
      MYSQL_DATABASE: wordpress
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
      MYSQL_ROOT_PASSWORD: root
    volumes:
      - poison_db_data:/var/lib/mysql
    mem_limit: 512m
  wordpress_poison:
    container_name: wordpress_poison
    build: 
      context: .
      dockerfile: Dockerfile_wordpress
    image: poison-wordpress
    #volumes:
    #  - ./wordpress_files:/var/www/html/
    ports: 
      - "8003:80"
    environment:
      WORDPRESS_DB_HOST: mysql_poison:3306
      WORDPRESS_DB_USER: admin
      WORDPRESS_DB_PASSWORD: admin
      WORDPRESS_DB_NAME: wordpress
    volumes:
      - poison_wordpress_data:/var/www/html
  phpmyadmin_poison:
    container_name: phpmyadmin_poison
    image: phpmyadmin/phpmyadmin
    links: 
      - mysql_poison:db
    ports:
      - 8004:80
    environment:
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
      MYSQL_ROOT_PASSWORD: root
volumes:
  poison_db_data:
  poison_wordpress_data:
                      </code></pre>
                    </blockquote>
                    <p>
                      De este modo, podemos tener un proyecto con WordPress funcionando localmente en cuestión de minutos.
                    </p>
                    <p>
                      Para alguien familiarizado con Docker, esto no es ningún misterio. Sin embargo, puede surgir la pregunta: ¿Por qué querríamos una configuración Docker en nuestro entorno local si lo que buscamos es crear un portafolio en la web? La respuesta a esta pregunta la exploraremos en el siguiente punto.
                    </p>

                    <h4>4. Automatización del despliegue de estos proyectos</h4>
                    <p>
                      Hasta ahora, nos hemos centrado en crear nuestro servidor y configurar los proyectos para ejecutarlos localmente con Docker. El siguiente paso es automatizar la subida de estos proyectos a nuestro servidor en la nube. Aunque este proceso se puede realizar manualmente, resulta mucho más cómodo y eficiente hacerlo mediante CI/CD (Integración y Despliegue Continuos) de GitHub.
                    </p>
                    <p>
                      Por ejemplo, para el proyecto de WordPress mencionado anteriormente, podríamos configurar un GitHub Actions de la siguiente manera:
                    </p>
                              
                    <blockquote class="wp-block-quote">
                      <pre><code>name: publish

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

env:
  OLD_DOMAIN: http://localhost:8003
  NEW_DOMAIN: https://poison.carlosmaroto-daweb.com
  SQL_DUMP_FILE: dump/wordpress.sql
  TARGET_DIR: wordpress_files/wp-content/themes/poison
  DOCKER_IMAGE_1: poison-db:latest
  DOCKER_IMAGE_2: poison-wordpress:latest
  DOCKER_FILE_1: Dockerfile_db
  DOCKER_FILE_2: Dockerfile_wordpress
  DOCKER_CONTAINER_1: mysql_poison
  DOCKER_CONTAINER_2: wordpress_poison
  DOCKER_CONTAINER_3: phpmyadmin_poison
  DOCKER_VOLUME_1: poison_db_data
  DOCKER_VOLUME_2: poison_wordpress_data
  PORT_1: 8003
  PORT_2: 8004
  PORT_3: 9000
  SUBDOMAIN: poison.carlosmaroto-daweb.com

jobs:
  create-docker-images:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the code
        uses: actions/checkout@v4

      - name: Login to GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.TOKEN_CD }}

      - name: Build image
        run: |
          sed -i "s#$OLD_DOMAIN#$NEW_DOMAIN#g" $SQL_DUMP_FILE
          find $TARGET_DIR -type f -exec sed -i "s#${OLD_DOMAIN}#${NEW_DOMAIN}#g" {} +
          docker build -f $DOCKER_FILE_1 --tag ghcr.io/carlosmaroto-daweb/$DOCKER_IMAGE_1 .
          docker push ghcr.io/carlosmaroto-daweb/$DOCKER_IMAGE_1
          docker build -f $DOCKER_FILE_2 --tag ghcr.io/carlosmaroto-daweb/$DOCKER_IMAGE_2 .
          docker push ghcr.io/carlosmaroto-daweb/$DOCKER_IMAGE_2
  
  deploy:
    needs: create-docker-images
    runs-on: ubuntu-latest
    steps:
      - name: SSH into Server
        run: |
          echo "${{ secrets.AUTH_PASS }}" > mi_clave.pem
          chmod 600 mi_clave.pem
          ssh -i mi_clave.pem -o StrictHostKeyChecking=no ${{ secrets.AUTH_SERVER }} << EOF
            sudo docker stop $DOCKER_CONTAINER_1 && sudo docker rm $DOCKER_CONTAINER_1
            sudo docker stop $DOCKER_CONTAINER_2 && sudo docker rm $DOCKER_CONTAINER_2
            sudo docker stop $DOCKER_CONTAINER_3 && sudo docker rm $DOCKER_CONTAINER_3
            sudo docker volume rm $(sudo docker volume ls -q | grep "$DOCKER_VOLUME_1")
            sudo docker volume rm $(sudo docker volume ls -q | grep "$DOCKER_VOLUME_2")
            sudo docker login ghcr.io -u carlosmaroto-daweb -p ${{ secrets.TOKEN_CD }}
            sudo docker pull ghcr.io/carlosmaroto-daweb/$DOCKER_IMAGE_1
            sudo docker pull ghcr.io/carlosmaroto-daweb/$DOCKER_IMAGE_2
            sudo echo '
              version: "3.1"
              services:
                $DOCKER_CONTAINER_1:
                  container_name: $DOCKER_CONTAINER_1
                  image: ghcr.io/carlosmaroto-daweb/$DOCKER_IMAGE_1
                  ports: 
                    - "$PORT_3:3306"
                  environment:
                    MYSQL_DATABASE: wordpress
                    MYSQL_USER: admin
                    MYSQL_PASSWORD: admin
                    MYSQL_ROOT_PASSWORD: root
                  volumes:
                    - $DOCKER_VOLUME_1:/var/lib/mysql
                  mem_limit: 512m
                $DOCKER_CONTAINER_2:
                  container_name: $DOCKER_CONTAINER_2
                  image: ghcr.io/carlosmaroto-daweb/$DOCKER_IMAGE_2
                  ports: 
                    - "$PORT_1:80"
                  environment:
                    WORDPRESS_DB_HOST: $DOCKER_CONTAINER_1:3306
                    WORDPRESS_DB_USER: admin
                    WORDPRESS_DB_PASSWORD: admin
                    WORDPRESS_DB_NAME: wordpress
                  volumes:
                    - $DOCKER_VOLUME_2:/var/www/html
                $DOCKER_CONTAINER_3:
                  container_name: $DOCKER_CONTAINER_3
                  image: phpmyadmin/phpmyadmin
                  links: 
                    - $DOCKER_CONTAINER_1:db
                  ports:
                    - $PORT_2:80
                  environment:
                    MYSQL_USER: admin
                    MYSQL_PASSWORD: admin
                    MYSQL_ROOT_PASSWORD: root
              volumes:
                $DOCKER_VOLUME_1:
                $DOCKER_VOLUME_2:
            ' >> docker-compose.yml
            sudo docker compose up -d
            sudo docker compose stop
            sudo rm docker-compose.yml
            sudo systemctl stop nginx
            if [ ! -f /etc/nginx/sites-available/$SUBDOMAIN ]; then
              sudo touch /etc/nginx/sites-available/$SUBDOMAIN
              sudo ln -s /etc/nginx/sites-available/$SUBDOMAIN /etc/nginx/sites-enabled/$SUBDOMAIN
              sudo certbot certonly --standalone -d $SUBDOMAIN --cert-name $SUBDOMAIN --non-interactive --agree-tos --email carlosmaroto.daweb@gmail.com
            fi
            sudo echo '
            server {
              listen 443 ssl;
              server_name $SUBDOMAIN;

              ssl_certificate /etc/letsencrypt/live/$SUBDOMAIN/fullchain.pem;
              ssl_certificate_key /etc/letsencrypt/live/$SUBDOMAIN/privkey.pem;

              location / {
                proxy_pass http://localhost:$PORT_1;
                proxy_set_header Host \$host;
                proxy_set_header X-Real-IP \$remote_addr;
                proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto \$scheme;
              }

              location /phpmyadmin/ {
                rewrite ^/phpmyadmin/(.*)$ /\$1 break;
                proxy_pass http://localhost:$PORT_2;
                proxy_set_header Host \$host;
                proxy_set_header X-Real-IP \$remote_addr;
                proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto \$scheme;
                proxy_redirect ~^(/.*)$ /phpmyadmin\$1;
              }

              error_page 502 @start_containers;

              location @start_containers {
                proxy_pass http://localhost:8080;
                proxy_set_header X-Subdomain $host;
              }
            }' > /tmp/nginx_site_config
            sudo mv /tmp/nginx_site_config /etc/nginx/sites-available/$SUBDOMAIN
            sudo systemctl start nginx
          EOF
                      </code></pre>
                    </blockquote>
                    <p>
                      Básicamente, este archivo de configuración ejecutará dos tareas cada vez que se haga un push o un pull request:
                    </p>
                    <ul>
                      <li>create-docker-images: Crea las imágenes Docker necesarias para el repositorio y las guarda en GitHub.</li>
                      <li>deploy: Se conecta por SSH a nuestro servidor para eliminar la versión anterior, descargar la nueva y configurar nginx como proxy inverso. Esto nos permitirá conectarnos a la máquina Docker mediante un subdominio.</li>
                    </ul>
                    <p>
                      Si has prestado atención al código, habrás notado que se utilizan Secretos de GitHub para manejar variables sensibles, como las claves SSH. Esto garantiza que dicha información no se haga pública.
                    </p>
                    <p>
                      Finalmente, cabe mencionar que, una vez creados, los contenedores se detienen. Puede que te preguntes por qué ocurre esto. La explicación se encuentra en el siguiente punto.
                    </p>

                    <h4>5. Gestión de los recursos de nuestro servidor</h4>
                    <p>
                      Si en el punto anterior no detenemos los contenedores después de crearlos, podríamos terminar con cientos de contenedores corriendo en la misma máquina. Recuerda que en la instalación de la instancia EC2 teníamos un límite de 1 vCPU y 1 GiB de RAM.
                    </p>
                    <p>
                      Con estas capacidades, es prácticamente imposible tener dos proyectos de WordPress funcionando simultáneamente, principalmente debido al consumo de CPU por parte de la base de datos. La solución ideal sería usar Kubernetes para orquestar los contenedores Docker, pero esta opción también consume muchos recursos.
                    </p>
                    <p>
                      Como solución temporal (o al menos para el servicio gratuito), hay una alternativa sencilla y de bajo consumo de recursos utilizando Flask.
                    </p>
                              
                    <p>
                      Hemos creado un script de Bash llamado "docker_control.sh" que detiene los contenedores en ejecución e inicia aquellos cuyo nombre se pase como parámetro.
                    </p>
                    <blockquote class="wp-block-quote">
                      <pre><code>#!/bin/bash

sudo docker stop $(sudo docker ps -q)
sudo docker start $(sudo docker ps -a | grep "$1" | awk '{print $1}')
                      </code></pre>
                    </blockquote>
                              
                    <p>
                      También hemos desarrollado un archivo en Python para lanzar nuestro servidor Flask. Este servidor, al recibir una solicitud (configurada previamente en nginx para que se dirija a este puerto en caso de un error 502, indicando que el contenedor no está en funcionamiento), ejecuta el script mencionado anteriormente y muestra una página web de carga.
                    </p>  
                    <blockquote class="wp-block-quote">
                      <pre><code>from flask import Flask, request, render_template
import subprocess

app = Flask(__name__)

@app.route('/<path:subpath>', methods=['GET'])
def handle_subpath(subpath):
    subdomain = request.headers.get('X-Subdomain')
    name = subdomain.split('.')[0]

    # Ejecutar el script Bash con el nombre del contenedor como argumento
    subprocess.run(['./docker_control.sh', name])

    # Renderizar la plantilla con la pantalla de carga
    return render_template('loading.html')

@app.route('/', methods=['GET'])
def handle_root():
    subdomain = request.headers.get('X-Subdomain')
    name = subdomain.split('.')[0]

    # Ejecutar el script Bash con el nombre del contenedor como argumento
    subprocess.run(['./docker_control.sh', name])

    # Renderizar la plantilla con la pantalla de carga
    return render_template('loading.html')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
                      </code></pre>
                    </blockquote>
                              
                    <p>
                      Finalmente, hemos creado una carpeta "templates" que contiene el archivo "loading.html". Esta página muestra una pantalla de carga durante 3 segundos para asegurarse de que los contenedores se han iniciado completamente y luego recarga la URL para acceder a ellos.
                    </p>  
                    <blockquote class="wp-block-quote">
                      <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Loading...&lt;/title&gt;
    &lt;style&gt;
        /* Estilos para la pantalla de carga */
        .loading-container {
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .loading-spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="loading-container"&gt;
        &lt;div class="loading-spinner"&gt;&lt;/div&gt;
    &lt;/div&gt;

    &lt;script&gt;
        // Esperar unos segundos para simular el proceso de carga
        setTimeout(function() {
            // Redireccionar de nuevo a la URL inicial
            window.location.reload();
        }, 3000); // 1000 milisegundos = 1 segundo, puedes ajustar este valor según sea necesario
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
                      </code></pre>
                  </blockquote>
                              
                  <p>
                    Solo nos quedaría levantar este servicio y comprobar que funciona correctamente
                  </p>
                  <blockquote class="wp-block-quote">
                    <pre><code>nohup python3 container_control.py &
sudo lsof -i :8080
                    </code></pre>
                  </blockquote>

                    <h4>Conclusión</h4>
                    <p>
                      Hemos configurado un sistema operativo Ubuntu en una instancia EC2 de AWS, accesible a través de un dominio .com y varios subdominios para diferentes proyectos. El servidor utiliza Nginx como proxy inverso para redirigir las solicitudes realizadas a través del dominio y los subdominios mencionados. En caso de que una solicitud falle porque los contenedores están detenidos, se llama al servidor Flask para iniciar los contenedores necesarios y detener los restantes. Además, hemos automatizado la implementación de proyectos mediante CI/CD con GitHub Actions, configurando Nginx en el servidor para vincularlo con los proyectos.
                    </p>
                    <p>
                      Con este setup, podemos desarrollar nuestros proyectos localmente y, al hacer un push, se automatiza todo el proceso de despliegue sin necesidad de acceder manualmente al servidor. Esto facilita el despliegue y mantiene un portafolio web sincronizado con tus repositorios de GitHub.
                    </p>
                    <p>
                      Sé que no he explicado todos los detalles y, aun así, este post ha resultado más largo de lo esperado. Si tienes dudas, no dudes en ponerte en contacto conmigo.
                    </p>
                    <p>
                      Además, puedes visitar mi web para ver los proyectos y acceder a mi GitHub para ver el código, que está todo publicado.
                    </p>
                    <p>
                      ¡Gracias por tu atención y espero que esta información te haya sido útil!
                    </p>
                  </div>

                </div>
              </article>

              <!-- post tags & social share -->
              <!--
              <div class="single-post_tag_share ">
                <div class="tj_tag">
                  <h4 class="tag__title">Tags: </h4>
                  <div class="tagcloud">
                    <a href="#" rel="tag">Business</a>
                    <a href="#" rel="tag">Analysis</a>
                    <a href="#" rel="tag">Technology</a>
                    <a href="#" rel="tag">Design</a>
                    <a href="#" rel="tag">Strategy</a>
                    <a href="#" rel="tag">Tips</a>
                  </div>
                </div>
                <div class="share_link">
                  <a href="#" target="_blank" class="facebook" title="Share this on Facebook"><i
                      class="fa-brands fa-facebook-f"></i></a>
                  <a href="#" class="twitter" title="Share this on Twitter" target="_blank"><i
                      class="fa-brands fa-x-twitter"></i></a>
                  <a href="#" class="linkedin" title="Share this on Linkedin" target="_blank"><i
                      class="fa-brands fa-linkedin-in"></i></a>
                  <a href="#" class="pinterest" title="Pin this Post" target="_blank"><i
                      class="fa-brands fa-pinterest-p"></i></a>
                </div>
              </div>
              -->
              
              <!-- post navigation -->
              <!--
              <div class="single-post__navigation">
                
                <div class="tj-navigation_post previous">

                  <div class="tj-navigation-post_inner prev_post">
                    <div class="navigation-post_img">
                      <a href="#">
                        <img src="./assets/img/blog/1.jpg" alt=""> </a>
                    </div>
                    <div class="tj-content">
                      <div class="post_pagination_nav">
                        <i class="fa-regular fa-angle-double-left"></i>previous
                      </div>
                      <div class="post_pagination_title">
                        <h5 class="title">
                          <a href="#">Building a Real Estate Website Tips and Ideas</a>
                        </h5>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="tj-navigation_post next">

                  <div class="tj-navigation-post_inner next_post">

                    <div class="tj-content">
                      <div class="post_pagination_nav">
                        Next<i class="fa-regular fa-angle-double-right"></i>
                      </div>
                      <div class="post_pagination_title">
                        <h5 class="title">
                          <a href="#">Architecture
                            Is Not Based On Concrete And Steel</a>
                        </h5>
                      </div>
                    </div>
                    <div class="navigation-post_img">
                      <a href="#">
                        <img src="./assets/img/blog/2.jpg" alt=""> </a>
                    </div>
                  </div>
                </div>
              </div>
              -->

              <!-- comments area -->
              <!--
              <div class="tj-comments__container">

                <div class="tj-comments__wrap">
                  <div class="tj-comment__title">
                    <h3>3 Comments</h3>
                  </div>

                  <div class="tj-latest__comments">
                    <ul>
                      <li class="tj__comment">
                        <div class="tj-comment__wrap">
                          <div class="comment__avatar">
                            <img alt="" src="./assets/img/blog/user-1.jpg">
                          </div>
                          <div class="comment__text">
                            <div class="avatar__name">
                              <h5><a href="">Jane Doe</a></h5>
                              <span>January 3, 2024</span>
                            </div>
                            <p>England dotted with a lush, green landscape, rustic villages and throbbing with humanity.
                              South Asian country that has plenty to offer to visitors with its diverse wildlife.</p>
                            <div class="comment__reply">
                              <a class="comment-reply-link" href="#">Reply</a>
                            </div>
                          </div>
                        </div>

                        <ul class="children">
                          <li class="tj__comment">
                            <div class="tj-comment__wrap">
                              <div class="comment__avatar">
                                <img alt="" src="./assets/img/blog/user-2.jpg">
                              </div>
                              <div class="comment__text">
                                <div class="avatar__name">
                                  <h5><a href=""> Fred Bloggs</a></h5>
                                  <span>February 3, 2024</span>
                                </div>
                                <p>It is a long established fact that a reader will be distracted by the readable
                                  content of a page when looking at its layout. The point of using Lorem Ipsum is that
                                  it has a more-or-less normal distribution of letters, as opposed to using 'Content
                                  here making it look like readable English.</p>
                                <div class="comment__reply">
                                  <a class="comment-reply-link" href="#">Reply</a>
                                </div>
                              </div>
                            </div>
                          </li>

                          <li class="tj__comment">
                            <div class="tj-comment__wrap">
                              <div class="comment__avatar">
                                <img alt="" src="./assets/img/blog/user-3.jpg">
                              </div>
                              <div class="comment__text">
                                <div class="avatar__name">
                                  <h5><a href="">Jane Bloggs</a></h5>
                                  <span>January 13, 2024</span>
                                </div>
                                <p>But I must explain to you how all this mistaken idea of denouncing pleasure and
                                  praising pain was born and I will give you a complete account</p>
                                <div class="comment__reply">
                                  <a class="comment-reply-link" href="#">Reply</a>
                                </div>
                              </div>
                            </div>
                          </li>
                        </ul>
                      </li>
                      <li class="tj__comment">
                        <div class="tj-comment__wrap">
                          <div class="comment__avatar">
                            <img alt="" src="./assets/img/blog/user-4.jpg">
                          </div>
                          <div class="comment__text">
                            <div class="avatar__name">
                              <h5><a href="">Themedemos</a></h5>
                              <span>January 20, 2024</span>
                            </div>
                            <p>There are many variations of passages of Lorem Ipsum available, but the majority have
                              suffered alteration in some form, by injected humour, or randomised words which don't look
                              even slightly believable. If you are going to use a passage you need to be sure there
                              isn't anything embarrassing hidden in the middle of text. All the</p>
                            <div class="comment__reply">
                              <a class="comment-reply-link" href="#">Reply</a>
                            </div>
                          </div>
                        </div>
                      </li>
                    </ul>
                  </div>
                </div>

                <div class="comment-respond">
                  <h3 class="comment-reply-title">
                    <span class="tj-comment__title">Leave a Reply</span>
                  </h3>

                  <form action="index.html" class="tj-post-comment__form">
                    <p class="comment-notes"><span id="email-notes">Your email address will not be published.</span>
                      <span class="required-field-message">Required fields are marked <span
                          class="required">*</span></span>
                    </p>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="form_group">
                          <input placeholder="Enter Name" id="author" name="author" type="text" aria-required="true">
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form_group">
                          <input placeholder="Enter Email" id="email" name="email" type="email" aria-required="true">
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="form_group">
                          <input placeholder="Enter Website" id="url" name="url" type="url">
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12 ">
                        <div class="form_group">
                          <textarea class="msg-box" placeholder="Enter Your Comments" id="comment" name="comment"
                            cols="45" rows="8"></textarea>
                        </div>
                      </div>
                      <div class="clearfix"></div>
                    </div>

                    <p class="comment-form-cookies-consent">
                      <input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox"
                        value="yes">
                      <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the
                        next time I comment.</label>
                    </p>
                    <button class="tj-btn-primary submit" type="submit">Post Comment </button>
                  </form>
                </div>
              </div>
              -->

            </div>
          </div>
          <!--
          <div class="col-lg-4">
            <div class="tj_main_sidebar">
              <div class="sidebar_widget widget_search wow fadeInUp" data-wow-delay=".3s">
                <div class="tj-widget__search form_group">
                  <form class="search-form" action="#" method="get">
                    <input type="search" id="search" name="search" placeholder="Search...">
                    <button class="search-btn" type="submit"> <i class="fa-light fa-magnifying-glass"></i> </button>
                  </form>
                </div>
              </div>

              <div class="sidebar_widget widget_categories wow fadeInUp" data-wow-delay=".3s">
                <div class="widget_title">
                  <h3 class="title">Categories</h3>
                </div>

                <ul>
                  <li><a href="#">Business</a> (4)</li>
                  <li><a href="#">Analysis</a> (0)</li>
                  <li><a href="#">Technology</a> (1)</li>
                  <li><a href="#">Technology</a> (10)</li>
                </ul>
              </div>

              <div class="sidebar_widget tj_recent_posts wow fadeInUp" data-wow-delay=".3s">
                <div class="widget_title">
                  <h3 class="title">Recent post</h3>
                </div>

                <ul>
                  <li>
                    <div class="recent-post_thumb">
                      <a href="blog-details.html">
                        <img src="./assets/img/blog/post-thumb-1.jpg" alt="">
                      </a>
                    </div>

                    <div class="recent-post_content">
                      <div class="tj-post__meta entry-meta">
                        <span><i class="fa-light fa-calendar-days"></i>Jan 2024</span>
                        <span><i class="fa-light fa-comments"></i><a href="#"> (3)</a></span>
                      </div>
                      <h4 class="recent-post_title">
                        <a href="blog-details.html">Definition and Principles of JIT Logistics</a>
                      </h4>
                    </div>
                  </li>
                  <li>
                    <div class="recent-post_thumb">
                      <a href="blog-details.html">
                        <img src="./assets/img/blog/post-thumb-2.jpg" alt="">
                      </a>
                    </div>

                    <div class="recent-post_content">
                      <div class="tj-post__meta entry-meta">
                        <span><i class="fa-light fa-calendar-days"></i>Jan 2024</span>
                        <span><i class="fa-light fa-comments"></i><a href="#"> (3)</a></span>
                      </div>
                      <h4 class="recent-post_title">
                        <a href="blog-details.html">Real-world Examples of Successful JIT Logistics</a>
                      </h4>
                    </div>
                  </li>
                  <li>
                    <div class="recent-post_thumb">
                      <a href="blog-details.html">
                        <img src="./assets/img/blog/post-thumb-3.jpg" alt="">
                      </a>
                    </div>

                    <div class="recent-post_content">
                      <div class="tj-post__meta entry-meta">
                        <span><i class="fa-light fa-calendar-days"></i>Jan 2024</span>
                        <span><i class="fa-light fa-comments"></i><a href="#"> (3)</a></span>
                      </div>
                      <h4 class="recent-post_title">
                        <a href="blog-details.html">Real-world Examples of Successful JIT Logistics</a>
                      </h4>
                    </div>
                  </li>
                </ul>
              </div>

              <div class="sidebar_widget widget_tag_cloud wow fadeInUp" data-wow-delay=".3s">
                <div class="widget_title">
                  <h3 class="title">Popular tag</h3>
                </div>

                <div class="tagcloud">
                  <a href="#">Business</a>
                  <a href="#">Analysis</a>
                  <a href="#">Technology</a>
                  <a href="#">Finance</a>
                  <a href="#">Design</a>
                </div>
              </div>
            </div>
          </div>
          -->
        </div>
      </div>
    </section>
    <!-- END: Blog Section -->
  </main>

  <!-- FOOTER AREA START -->
  <footer class="tj-footer-area">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center">
          <div class="footer-logo-box">
            <a href="index.html"><img src="assets/img/logo/logo.png" alt="Carlos Maroto Daweb"></a>
          </div>
          <div class="footer-menu">
            <nav>
              <ul>
                <li><a href="index.html#resume-section">Resumen</a></li>
                <li><a href="index.html#skills-section">Tecnologías</a></li>
                <li><a href="index.html#works-section">Trabajos</a></li>
                <li><a href="index.html#blog-section">Blog</a></li>
                <!--
                <li><a href="#contact-section">Contacto</a></li>
                -->
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!-- FOOTER AREA END -->


  <!-- CSS here -->
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/nice-select.min.js"></script>
  <script src="assets/js/backToTop.js"></script>
  <script src="assets/js/smooth-scroll.js"></script>
  <script src="assets/js/appear.min.js"></script>
  <script src="assets/js/wow.min.js"></script>
  <script src="assets/js/gsap.min.js"></script>
  <script src="assets/js/one-page-nav.js"></script>
  <script src="assets/js/lightcase.js"></script>
  <script src="assets/js/owl.carousel.min.js"></script>
  <script src="assets/js/isotope.pkgd.min.js"></script>
  <script src="assets/js/odometer.min.js"></script>
  <script src="assets/js/magnific-popup.js"></script>

  <script src="assets/js/main.js"></script>
</body>

</html>